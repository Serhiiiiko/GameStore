@model IEnumerable<Game>
@{
    ViewData["Title"] = "Главная";
    var userOrders = ViewBag.UserOrders as IEnumerable<Order> ?? new List<Order>();
}

<!-- ***** Banner Start ***** -->
<div class="main-banner">
    <div class="row">
        <div class="col-lg-7">
            <div class="header-text">
                <h6>Добро пожаловать в Магазин Игр</h6>
                <h4><em>Просмотрите</em> наши популярные игры</h4>
                <div class="main-button">
                    <a asp-controller="Home" asp-action="SteamTopUp">Пополнить Steam</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ***** Banner End ***** -->
<!-- ***** Most Popular Start ***** -->
<div class="most-popular">
    <div class="row">
        <div class="col-lg-12">
            <div class="heading-section">
                <h4><em>Купить игры</em> сейчас</h4>
            </div>
            <div class="row">
                @foreach (var game in Model.Take(8))
                {
                    <div class="col-lg-3 col-sm-6">
                        <div class="item" data-id="@game.Id" data-price="@game.Price">
                            <img src="@(string.IsNullOrEmpty(game.ImageUrl) ? "/images/popular-01.jpg" : game.ImageUrl)"
                                 alt="@game.Title"
                                 style="width: 225px; height: 190px; object-fit: cover; border-radius: 23px; display: block; margin: 0 auto;">
                            <h4>@game.Title<br><span>@game.Genre</span></h4>
                            <ul>
                                <li><i class="fa fa-star"></i> @game.Rating</li>
                                <li style="color: #ec6090; font-weight: bold;">@game.Price.ToString("₽0")</li>
                            </ul>
                        </div>
                    </div>
                }
            </div>
            <div class="col-lg-12">
                <div class="main-button">
                    <a asp-controller="Games" asp-action="Index">Открыть все игры</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- ***** Most Popular End ***** -->
<!-- ***** Gaming Library Start ***** -->
<div class="gaming-library">
    <div class="col-lg-12">
        <div class="heading-section">
            <h4><em>Ваши</em> покупки</h4>
        </div>

        @if (ViewBag.UserOrders == null || !((IEnumerable<Order>)ViewBag.UserOrders).Any())
        {
            <div class="item">
                <p>У вас пока нет покупок. Посмотрите наш каталог игр и выберите то, что вам нравится!</p>
            </div>
        }
        else
        {
            @foreach (var order in (IEnumerable<Order>)ViewBag.UserOrders)
            {
                <div class="item">
                    <ul>
                        <li>
                            <img src="@(string.IsNullOrEmpty(order.Game?.ImageUrl) ? "/images/game-01.jpg" : order.Game.ImageUrl)"
                                 alt="@order.Game?.Title" class="templatemo-item">
                        </li>
                        <li><h4>@order.Game?.Title</h4><span>@order.Game?.Genre</span></li>
                        <li><h4>Дата добавления</h4><span>@order.OrderDate.ToString("dd/MM/yyyy")</span></li>
                        <li><h4>Ключ</h4><span>@order.Key</span></li>
                        <li><h4>Статус</h4><span>@(order.IsCompleted ? "Загружено" : "В обработке")</span></li>
                        <li><h4>Цена</h4><span>@order.Game?.Price.ToString("₽0")</span></li>
                    </ul>
                </div>
            }
        }
    </div>
    <div class="col-lg-12">
        <div class="main-button">
            <a asp-controller="Home" asp-action="PurchaseHistory">Просмотреть вашу библиотеку</a>
        </div>
    </div>
</div>
<!-- ***** Gaming Library End ***** -->
<!-- Purchase Modal -->
<div class="modal fade" id="purchaseModal" tabindex="-1" aria-labelledby="purchaseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="background-color: #27292a; color: #fff; border-radius: 23px;">
            <div class="modal-header" style="border-bottom: 1px solid #444;">
                <h5 class="modal-title" id="purchaseModalLabel">Купить игру</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4">
                        <img id="gameImage" src="" alt="Game Image" class="img-fluid rounded" style="max-width: 100%;">
                        <div class="mt-3">
                            <h5 id="gameTitle" class="mb-2"></h5>
                            <p id="gameGenre" style="color: #ec6090;"></p>
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <div><i class="fa fa-star" style="color: yellow;"></i> <span id="gameRating"></span></div>
                            </div>
                            <h5>Цена: <span id="gamePrice" style="color: #ec6090; font-weight: bold;"></span></h5>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <form asp-controller="Games" asp-action="Purchase" method="post">
                            <input type="hidden" id="gameId" name="gameId" value="">
                            
                            <div class="mb-4">
                                <label for="email" class="form-label">Ваш E-mail:</label>
                                <input type="email" class="form-control" id="email" name="email" required
                                       style="background-color: #1f2122; border: 1px solid #444; color: #fff;">
                                <small class="text-muted">На этот адрес будет отправлен ключ активации игры</small>
                            </div>
                            
                            <div class="mb-4">
                                <label class="form-label">Способ оплаты:</label>
                                <div class="payment-methods">
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="payment-method-item" style="background-color: #1f2122; border-radius: 10px; padding: 15px; cursor: pointer; border: 2px solid transparent;">
                                                <input type="radio" name="paymentMethod" id="card" value="card" class="d-none" checked>
                                                <label for="card" class="d-flex align-items-center mb-0" style="cursor: pointer;">
                                                    <i class="far fa-credit-card me-2" style="font-size: 24px; color: #e75e8d;"></i>
                                                    <span>Банковская карта</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="payment-method-item" style="background-color: #1f2122; border-radius: 10px; padding: 15px; cursor: pointer; border: 2px solid transparent;">
                                                <input type="radio" name="paymentMethod" id="qiwi" value="qiwi" class="d-none">
                                                <label for="qiwi" class="d-flex align-items-center mb-0" style="cursor: pointer;">
                                                    <i class="fas fa-wallet me-2" style="font-size: 24px; color: #99d4ff;"></i>
                                                    <span>QIWI Кошелек</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="payment-method-item" style="background-color: #1f2122; border-radius: 10px; padding: 15px; cursor: pointer; border: 2px solid transparent;">
                                                <input type="radio" name="paymentMethod" id="webmoney" value="webmoney" class="d-none">
                                                <label for="webmoney" class="d-flex align-items-center mb-0" style="cursor: pointer;">
                                                    <i class="fas fa-money-bill-alt me-2" style="font-size: 24px; color: #8bc34a;"></i>
                                                    <span>WebMoney</span>
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <div class="payment-method-item" style="background-color: #1f2122; border-radius: 10px; padding: 15px; cursor: pointer; border: 2px solid transparent;">
                                                <input type="radio" name="paymentMethod" id="yoomoney" value="yoomoney" class="d-none">
                                                <label for="yoomoney" class="d-flex align-items-center mb-0" style="cursor: pointer;">
                                                    <i class="fas fa-ruble-sign me-2" style="font-size: 24px; color: #ffeb3b;"></i>
                                                    <span>ЮMoney</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-check mb-4">
                                <input class="form-check-input" type="checkbox" id="agreeTerms" required
                                       style="background-color: #1f2122; border: 1px solid #444;">
                                <label class="form-check-label" for="agreeTerms">
                                    Я согласен с условиями <a href="#" style="color: #e75e8d;">пользовательского соглашения</a>
                                </label>
                            </div>
                            
                            <div class="mt-4">
                                <button type="submit" class="btn btn-primary w-100 py-3"
                                        style="background-color: #e75e8d; border: none; font-size: 18px;">
                                    <i class="fas fa-shopping-cart me-2"></i> Оплатить
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
          // Find all game items and make them clickable
          const gameItems = document.querySelectorAll('.most-popular .item');

          gameItems.forEach(function(item) {
            item.style.cursor = 'pointer';

            item.addEventListener('click', function() {
              // Get game details
              const gameId = item.getAttribute('data-id');
              const gameImage = item.querySelector('img').src;
              const gameTitle = item.querySelector('h4').innerText.split('\n')[0];
              const gameGenre = item.querySelector('h4 span').innerText;
              const gameRating = item.querySelector('ul li:first-child').innerText.replace('★', '').trim();
              const gameDownloads = item.querySelector('ul li:last-child').innerText.replace('⬇', '').trim();
              const gamePrice = item.getAttribute('data-price') + ' ₽';

              // Populate modal
              document.getElementById('gameId').value = gameId;
              document.getElementById('gameImage').src = gameImage;
              document.getElementById('gameTitle').innerText = gameTitle;
              document.getElementById('gameGenre').innerText = gameGenre;
              document.getElementById('gameRating').innerText = gameRating;
              document.getElementById('gamePrice').innerText = gamePrice;

              // Show modal
              const purchaseModal = new bootstrap.Modal(document.getElementById('purchaseModal'));
              purchaseModal.show();
            });
          });
        });
                // Add to the Scripts section for both pages
        $(document).ready(function() {
            // Style for payment method selection on both home and catalog pages
            $('.payment-method-item').click(function() {
                // Remove active class from all items
                $('.payment-method-item').css('border-color', 'transparent');
                $(this).css('border-color', '#e75e8d');

                // Select the radio button
                $(this).find('input[type="radio"]').prop('checked', true);
            });

            // Initialize - highlight the first payment method
            $('.payment-method-item:has(input:checked)').css('border-color', '#e75e8d');

            // Add highlighting when hovering over payment methods
            $('.payment-method-item').hover(
                function() {
                    if ($(this).find('input').is(':not(:checked)')) {
                        $(this).css('border-color', '#666');
                    }
                },
                function() {
                    if ($(this).find('input').is(':not(:checked)')) {
                        $(this).css('border-color', 'transparent');
                    }
                }
            );
        });
    </script>
}